<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnyHA - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --primary-color: #00ffc3; --secondary-color: #a972ff; --background-dark: #1a1a2e; --text-light: #e0e0e0; --text-dark: #333; --glass-bg: rgba(255, 255, 255, 0.1); --glass-border: rgba(255, 255, 255, 0.2); --shadow-color: rgba(31, 38, 135, 0.37); --danger-color: #ef5350; --success-color: #66bb6a; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #161623; color: var(--text-light); }
        .mobile-container { width: 375px; height: 812px; background: var(--background-dark); border-radius: 40px; box-shadow: 0 15px 50px rgba(0,0,0,0.5); overflow: hidden; position: relative; display: flex; flex-direction: column; }
        .hidden { display: none !important; }
        .glass-card { background: var(--glass-bg); backdrop-filter: blur(15px); border: 1px solid var(--glass-border); border-radius: 20px; padding: 20px; margin-bottom: 20px; }
        .btn-primary, .btn-secondary { width: 100%; padding: 15px; border: none; border-radius: 15px; font-weight: 600; cursor: pointer; }
        .btn-primary { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: var(--text-dark); }
        .btn-secondary { background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-light); margin-top:10px; }
        .form-group { margin-bottom: 15px; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--text-light); }
        .main-app { height:100%; display:flex; flex-direction:column; }
        #main-content { flex-grow: 1; padding: 0 20px 20px; overflow-y: auto; scrollbar-width: none; }
        .bottom-nav { display: flex; padding: 10px 0; margin: 0 20px 10px; border-radius: 25px; }
        .nav-button { flex: 1; background: none; border: none; color: var(--text-light); display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .nav-button.active { color: var(--primary-color); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: var(--background-dark); border: 1px solid var(--glass-border); width: 90%; max-width: 400px; max-height: 80vh; border-radius: 20px; display: flex; flex-direction: column; }
        .modal-header { padding: 15px 20px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 20px; overflow-y: auto; }
        .modal-close-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div id="admin-login-screen">
            <div class="glass-card"><h1>Admin Panel</h1><div class="form-group"><input type="email" id="admin-email" value="admin@earnyha.com"></div><div class="form-group"><input type="password" id="admin-password" placeholder="Password"></div><button id="admin-login-button" class="btn-primary">Login</button></div>
        </div>
        <div id="main-app-ui" class="main-app hidden">
            <header style="padding: 25px 20px 15px; display: flex; justify-content: space-between; align-items: center;"><h1 id="header-title"></h1><i class="fa-solid fa-sign-out-alt" id="admin-logout-button"></i></header>
            <main id="main-content"></main>
            <nav class="bottom-nav glass-card">
                <button class="nav-button active" data-screen="dashboard"><i class="fas fa-tachometer-alt"></i></button>
                <button class="nav-button" data-screen="users"><i class="fas fa-users"></i></button>
                <button class="nav-button" data-screen="content"><i class="fas fa-edit"></i></button>
                <button class="nav-button" data-screen="withdrawals"><i class="fas fa-hand-holding-usd"></i></button>
            </nav>
        </div>
    </div>
    <div id="modal-container"></div>
<script>
document.addEventListener('DOMContentLoaded', () => {

    // -----------------------------------------------------------------
    // 1. FIREBASE CONFIG (REPLACE WITH YOURS)
    // -----------------------------------------------------------------
    const firebaseConfig = {
  apiKey: "AIzaSyAvOCamAwrk7yg-I6RVuMfzE_vKbZlAwwo",
  authDomain: "earnyha-app.firebaseapp.com",
  databaseURL: "https://earnyha-app-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "earnyha-app",
  storageBucket: "earnyha-app.firebasestorage.app",
  messagingSenderId: "117222358496",
  appId: "1:117222358496:web:40ef494c898fea61ebff85",
  measurementId: "G-ME6C5D883Z"
};
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- 2. DOM & STATE ---
    const dom = { login: document.getElementById('admin-login-screen'), app: document.getElementById('main-app-ui'), main: document.getElementById('main-content'), header: document.getElementById('header-title'), modal: document.getElementById('modal-container'), nav: document.querySelector('.bottom-nav') };
    const appState = { allUsers: [], allTasks: [], allGames: [], currentEditing: { type: null, id: null } };

    // --- 3. AUTH ---
    auth.onAuthStateChanged(user => {
        if (user && user.email === 'admin@earnyha.com') {
            dom.app.classList.remove('hidden');
            dom.login.classList.add('hidden');
            renderScreen('dashboard');
        } else {
            dom.app.classList.add('hidden');
            dom.login.classList.remove('hidden');
        }
    });
    document.getElementById('admin-login-button').addEventListener('click', async () => { try { await auth.signInWithEmailAndPassword(document.getElementById('admin-email').value, document.getElementById('admin-password').value); } catch(e) { alert(e.message); }});
    document.getElementById('admin-logout-button').addEventListener('click', () => auth.signOut());

    // --- 4. NAVIGATION ---
    dom.nav.addEventListener('click', e => { if(e.target.closest('.nav-button')) renderScreen(e.target.closest('.nav-button').dataset.screen) });

    function renderScreen(screenId){
        dom.header.textContent = screenId.charAt(0).toUpperCase() + screenId.slice(1);
        dom.nav.querySelector('.active')?.classList.remove('active');
        dom.nav.querySelector(`[data-screen=${screenId}]`).classList.add('active');
        dom.main.innerHTML = `<div style="display: flex; justify-content: center; padding: 40px;"><div class="spinner" style="width: 40px; height: 40px; border: 4px solid var(--glass-border); border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite;"></div></div>`;

        const screenRenderers = {
            dashboard: renderDashboard, users: renderUsers, content: renderContent, withdrawals: renderWithdrawals
        };
        if(screenRenderers[screenId]) screenRenderers[screenId]();
    }
    
    // --- 5. SCREEN RENDERERS ---
    async function renderDashboard(){
        const [users, withdrawals, tasks, games] = await Promise.all([db.collection('users').get(), db.collection('withdrawals').where('status','==','pending').get(), db.collection('tasks').get(), db.collection('games').get()]);
        dom.main.innerHTML = `
            <div class="glass-card" style="text-align:center;"><p style="font-size:32px;">${users.size}</p><p>Total Users</p></div>
            <div class="glass-card" style="text-align:center;"><p style="font-size:32px;">${withdrawals.size}</p><p>Pending Withdrawals</p></div>
            <div class="glass-card" style="text-align:center;"><p style="font-size:32px;">${tasks.size}</p><p>Total Tasks</p></div>
            <div class="glass-card" style="text-align:center;"><p style="font-size:32px;">${games.size}</p><p>Total Games</p></div>`;
    }
    
    async function renderUsers(){
        const snapshot = await db.collection('users').get();
        appState.allUsers = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
        let userCards = appState.allUsers.map(user => `<div class="glass-card" style="display:flex; justify-content:space-between; align-items:center;"><div><p><strong>${user.username}</strong></p><p>â‚¹${user.balance.toFixed(2)}</p></div><button class="btn-secondary" style="width:auto; padding:8px 15px;" onclick="openUserModal('${user.id}')">View</button></div>`).join('');
        dom.main.innerHTML = `<input type="search" id="user-search-input" placeholder="Search users...">${userCards}`;
        document.getElementById('user-search-input').addEventListener('input', e => { /* search logic can be added */ });
    }
    
    async function renderContent(){
        const [announcements, tasks, games] = await Promise.all([db.collection('announcements').get(), db.collection('tasks').get(), db.collection('games').get()]);
        dom.main.innerHTML = `
            <div class="glass-card"><h3>Announcements</h3><textarea id="announcement-text" placeholder="New announcement..."></textarea><button class="btn-primary" onclick="handleAnnouncement()">Send</button></div>
            <div class="glass-card"><h3>Tasks</h3><p>Total: ${tasks.size}</p><button class="btn-secondary" onclick="openContentModal('task')">Add New Task</button></div>
            <div class="glass-card"><h3>Games</h3><p>Total: ${games.size}</p><button class="btn-secondary" onclick="openContentModal('game')">Add New Game</button></div>`;
    }
    
    async function renderWithdrawals(){
        const snapshot = await db.collection('withdrawals').where('status','==','pending').orderBy('requestedAt','desc').get();
        if(snapshot.empty){ dom.main.innerHTML = `<div class="glass-card"><p>No pending withdrawals.</p></div>`; return; }
        let cards = snapshot.docs.map(doc => {
            const req = doc.data();
            return `<div class="glass-card"><p><strong>${req.username}</strong></p><p>Amount: â‚¹${req.amount.toFixed(2)}</p><p>UPI: ${req.upiId}</p><div style="display:flex; gap:10px; margin-top:15px;"><button class="btn-primary" style="background:var(--success-color);" onclick="handleWithdrawal('${doc.id}', true)">Approve</button><button class="btn-secondary" onclick="handleWithdrawal('${doc.id}', false, '${req.userId}', ${req.amount})">Reject</button></div></div>`;
        }).join('');
        dom.main.innerHTML = cards;
    }
    
    // --- 6. MODAL & FORM HANDLERS ---
    window.openUserModal = (userId) => {
        const user = appState.allUsers.find(u => u.id === userId);
        dom.modal.innerHTML = `
            <div class="modal-overlay">
                <div class="modal-content">
                    <div class="modal-header"><h3>${user.username}</h3><button class="modal-close-btn" onclick="closeModal()">Ã—</button></div>
                    <div class="modal-body">
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Balance:</strong> â‚¹${user.balance.toFixed(2)}</p>
                        <hr style="margin:20px 0; border-color:var(--glass-border);">
                        <h4>Balance Adjustment</h4>
                        <div class="form-group"><input type="number" id="balance-adjustment-amount" placeholder="e.g., 10 (add) or -10 (deduct)"></div>
                        <button class="btn-primary" onclick="adjustBalance('${userId}')">Adjust Balance</button>
                    </div>
                </div>
            </div>`;
    };
    
    window.openContentModal = (type, id = null) => { /* Logic to open a modal for creating/editing tasks/games */ };
    window.closeModal = () => dom.modal.innerHTML = '';
    
    // --- 7. ACTION HANDLERS ---
    window.adjustBalance = async (userId) => { /* Balance adjustment logic */ };
    window.handleAnnouncement = async () => { await db.collection('announcements').add({ message: document.getElementById('announcement-text').value, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); alert('Announcement sent!'); renderContent(); };
    window.handleWithdrawal = async (reqId, isApproved, userId, amount) => {
        const withdrawalRef = db.collection('withdrawals').doc(reqId);
        if(isApproved){
            await withdrawalRef.update({ status: 'completed' });
        } else {
            const userRef = db.collection('users').doc(userId);
            await db.runTransaction(async t => { t.update(withdrawalRef, { status: 'rejected' }); t.update(userRef, { balance: firebase.firestore.FieldValue.increment(amount) }); });
        }
        alert('Action successful!'); renderWithdrawals();
    };
    
    // --- KICKSTART ADMIN PANEL ---
    init();
    function init() {
        // This function can be expanded if needed
    }
});
</script>
</body>
</html>
