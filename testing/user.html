<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>EarnyHA - Earn Rewards</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary-color: #05e8ba;
            --secondary-color: #a972ff;
            --pink-glow: #ff57a4;
            --background-dark: #12121c;
            --text-light: #f0f0f0;
            --text-dark: #1f1f1f;
            --glass-bg: rgba(40, 40, 60, 0.3);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.2);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #161623; color: var(--text-light); }
        .mobile-container { width: 375px; height: 812px; background: var(--background-dark); border-radius: 40px; box-shadow: 0 15px 50px var(--shadow-color); overflow: hidden; position: relative; display: flex; flex-direction: column; }
        .background-shapes { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; overflow: hidden; }
        .background-shapes .shape { position: absolute; border-radius: 50%; filter: blur(70px); opacity: 0.5; animation: move 20s linear infinite alternate; }
        .shape1 { width: 250px; height: 250px; background: var(--primary-color); top: -80px; left: -120px; animation-duration: 25s;}
        .shape2 { width: 200px; height: 200px; background: var(--pink-glow); top: 45%; left: -100px; animation-duration: 30s;}
        .shape3 { width: 250px; height: 250px; background: var(--secondary-color); bottom: -80px; right: -120px; animation-duration: 20s;}
        @keyframes move { 100% { transform: translateY(40px) translateX(-40px) rotate(180deg); } }
        .app-screen-wrapper { position: relative; z-index: 2; height: 100%; display: flex; flex-direction: column; }
        
        /* --- NEW: Screen Transition System --- */
        .content-screen { position: absolute; width:100%; height:100%; top:0; left:0; padding: 0 20px 20px; overflow-y: auto; opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; transform: translateX(20px); scrollbar-width: none; }
        .content-screen::-webkit-scrollbar { display: none; }
        .content-screen.active { opacity: 1; visibility: visible; transform: translateX(0); }
        /* --- END: Screen Transition System --- */

        .hidden { display: none !important; }
        .glass-card { background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 20px; padding: 20px; box-shadow: 0 8px 32px 0 var(--shadow-color); margin-bottom: 20px; position: relative; overflow: hidden; }
        .form-group input { width: 100%; padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); border-radius: 10px; color: var(--text-light); }
        .btn-primary { width: 100%; padding: 15px; border: none; border-radius: 15px; font-weight: 600; cursor: pointer; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: var(--text-dark); transition: transform 0.2s, box-shadow 0.2s; }
        .btn-primary:hover { box-shadow: 0 0 20px rgba(5, 232, 186, 0.5); }
        .btn-primary:active { transform: scale(0.98); }
        .btn-primary:disabled { background: #555; color: #999; cursor: not-allowed; box-shadow: none; }
        .app-header { padding: 25px 20px 15px; display: flex; justify-content: space-between; align-items: center; font-size: 24px; font-weight: 700; color: white; text-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #main-content { position: relative; flex-grow: 1; }
        .footer-nav { display: flex; justify-content: space-around; align-items: center; padding: 5px 0; margin: 0 20px 15px; border-radius: 25px; position: relative; overflow: visible; }
        .footer-nav::before { content: ''; position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 150%; height: 150%; background: radial-gradient(circle, rgba(169, 114, 255, 0.4) 0%, rgba(169, 114, 255, 0) 60%); z-index: -1; filter: blur(10px); }
        .nav-button { flex: 1; background: none; border: none; color: var(--text-light); display: flex; flex-direction: column; align-items: center; cursor: pointer; padding: 8px 0; font-size: 12px; font-weight: 500; transition: color 0.2s, transform 0.2s; z-index: 1; }
        .nav-button i { font-size: 22px; margin-bottom: 4px; }
        .nav-button.active i, .nav-button.active { color: var(--primary-color); }
        .nav-button:not(.active) { opacity: 0.7; }
        .nav-button:active { transform: scale(0.9); }
        .screen-title { text-align: center; font-size: 22px; font-weight: 600; margin-bottom: 25px; }
        .loader-container { display: flex; justify-content: center; align-items: center; padding: 40px; }
        .spinner { width: 40px; height: 40px; border: 4px solid var(--glass-border); border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #toast-notification { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: var(--text-dark); padding: 12px 25px; border-radius: 15px; font-weight: 600; z-index: 1000; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); text-align: center; }
        #toast-notification.show { bottom: 120px; transform: translateX(-50%) scale(1); }
        .balance-card { border: 1px solid rgba(5, 232, 186, 0.5); box-shadow: 0 0 40px -15px var(--primary-color); }
        .actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .action-button { background: var(--glass-bg); padding: 15px; border-radius: 20px; text-align: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; border: 1px solid transparent; }
        .action-button:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .action-button:active { transform: scale(0.95); }
        .action-button i { font-size: 24px; color: var(--primary-color); margin-bottom: 8px; }
        .action-button.refer-card { border-color: var(--pink-glow); box-shadow: 0 0 30px -15px var(--pink-glow); }
        .back-button { position: absolute; top: -5px; left: 0; font-size: 24px; cursor: pointer; z-index: 5; padding:10px; }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div class="background-shapes"><div class="shape shape1"></div><div class="shape shape2"></div><div class="shape shape3"></div></div>
        <div class="app-screen-wrapper">
            <div id="auth-container"></div>
            <header id="app-header" class="hidden"></header>
            <main id="main-content" class="hidden">
                <!-- Screens will be injected here -->
                <div id="home-screen" class="content-screen"></div>
                <div id="tasks-screen" class="content-screen"></div>
                <div id="withdraw-screen" class="content-screen"></div>
                <div id="profile-screen" class="content-screen"></div>
                <!-- Sub-screens -->
                <div id="dailyBonus-screen" class="content-screen"></div>
                <div id="earningWheel-screen" class="content-screen"></div>
                <div id="refer-screen" class="content-screen"></div>
            </main>
            <footer id="bottom-nav" class="glass-card footer-nav hidden"></footer>
        </div>
        <div id="toast-notification"></div>
    </div>
<script>
// --- EARNYHA V9.0 - FINAL BUG FIX & LAYOUT ---
document.addEventListener('DOMContentLoaded', () => {

    const firebaseConfig = {
      apiKey: "AIzaSyAvOCamAwrk7yg-I6RVuMfzE_vKbZlAwwo",
      authDomain: "earnyha-app.firebaseapp.com",
      databaseURL: "https://earnyha-app-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "earnyha-app",
      storageBucket: "earnyha-app.firebasestorage.app",
      messagingSenderId: "117222358496",
      appId: "1:117222358496:web:40ef494c898fea61ebff85",
      measurementId: "G-ME6C5D883Z"
    };

    try {
        firebase.initializeApp(firebaseConfig);
    } catch (e) {
        console.error("Firebase initialization failed.", e);
        document.body.innerHTML = '<h1>Firebase Config Error. Check Console.</h1>';
        return;
    }

    const auth = firebase.auth();
    const db = firebase.firestore();

    const appState = { currentUser: null, userData: {}, userDataUnsubscribe: null };
    const dom = { auth: document.getElementById('auth-container'), header: document.getElementById('app-header'), main: document.getElementById('main-content'), nav: document.getElementById('bottom-nav'), toast: document.getElementById('toast-notification') };

    const templates = {
        header: `<span>EarnyHA</span><i class="fa-solid fa-right-from-bracket" id="logout-button" style="cursor:pointer;"></i>`,
        nav: `
            <button class="nav-button active" data-screen="home"><i class="fa-solid fa-house"></i>Home</button>
            <button class="nav-button" data-screen="tasks"><i class="fa-solid fa-rocket"></i>Tasks</button>
            <button class="nav-button" data-screen="withdraw"><i class="fa-solid fa-money-bill-transfer"></i>Withdraw</button>
            <button class="nav-button" data-screen="profile"><i class="fa-solid fa-user"></i>Profile</button>`,
        loader: `<div class="loader-container"><div class="spinner"></div></div>`,
        authForm: (type) => { /* Same as V8 */ }
    };
    
    function init() {
        auth.onAuthStateChanged(user => {
            const wasLoggedIn = !!appState.currentUser;
            if (user) {
                appState.currentUser = user;
                if (!wasLoggedIn) {
                    renderAppLayout(true);
                    renderScreen('home');
                }
                if (appState.userDataUnsubscribe) appState.userDataUnsubscribe();
                appState.userDataUnsubscribe = db.collection('users').doc(user.uid).onSnapshot(doc => {
                    if (doc.exists) appState.userData = { id: doc.id, ...doc.data() };
                    updateDynamicUI();
                });
            } else {
                if (appState.userDataUnsubscribe) appState.userDataUnsubscribe();
                appState.currentUser = null;
                renderAppLayout(false);
                renderAuthScreen('login');
            }
        });
    }

    function renderAppLayout(isLoggedIn) {
        dom.header.classList.toggle('hidden', !isLoggedIn);
        dom.main.classList.toggle('hidden', !isLoggedIn);
        dom.nav.classList.toggle('hidden', !isLoggedIn);
        dom.auth.classList.toggle('hidden', isLoggedIn);

        if (isLoggedIn) {
            dom.header.innerHTML = templates.header;
            dom.nav.innerHTML = templates.nav;
            addEventListeners();
        }
    }
    
    function addEventListeners() {
        // Use event delegation on a parent element for robustness
        document.body.addEventListener('click', e => {
            const logoutButton = e.target.closest('#logout-button');
            if (logoutButton) auth.signOut();
            
            const navButton = e.target.closest('.nav-button');
            if (navButton && !navButton.classList.contains('active')) {
                renderScreen(navButton.dataset.screen);
            }
        });
    }

    function renderAuthScreen(type) { /* Same as V8 */ }

    function updateDynamicUI(){
        const balanceEl = document.getElementById('balance-display');
        if(balanceEl) balanceEl.textContent = (appState.userData.balance || 0).toFixed(2);
    }
    
    function renderScreen(screenId) {
        // Handle nav active state
        const currentActiveNav = dom.nav.querySelector('.active');
        if(currentActiveNav) currentActiveNav.classList.remove('active');
        const newActiveNav = dom.nav.querySelector(`[data-screen=${screenId}]`);
        if(newActiveNav) newActiveNav.classList.add('active');

        // Handle screen visibility
        const currentActiveScreen = dom.main.querySelector('.content-screen.active');
        if(currentActiveScreen) currentActiveScreen.classList.remove('active');
        const newActiveScreen = document.getElementById(`${screenId}-screen`);
        if(newActiveScreen) {
            newActiveScreen.classList.add('active');
        } else {
            console.error(`Screen with id "${screenId}-screen" not found!`);
            return;
        }

        const screenRenderer = window['render' + screenId.charAt(0).toUpperCase() + screenId.slice(1) + 'Content'];
        if (screenRenderer) {
            screenRenderer(newActiveScreen);
        } else {
            newActiveScreen.innerHTML = `<h2 class="screen-title">${screenId}</h2><div class="glass-card"><p>Coming Soon!</p></div>`;
        }
    }

    window.renderHomeContent = function(screenEl) {
        screenEl.innerHTML = `
            <div class="glass-card balance-card">
                <p style="opacity:0.8;">Your Current Balance</p>
                <p style="font-size: 48px; font-weight: 700; color:white;"><sup>₹</sup><span id="balance-display">${(appState.userData.balance || 0).toFixed(2)}</span></p>
            </div>
            <div class="actions-grid">
                <div class="action-button" onclick="renderScreen('tasks')"><i class="fa-solid fa-list-check"></i><p>Earn Now</p></div>
                <div class="action-button" onclick="renderScreen('withdraw')"><i class="fa-solid fa-wallet"></i><p>Withdraw</p></div>
                <div class="action-button" onclick="renderScreen('dailyBonus')"><i class="fa-solid fa-calendar-day"></i><p>Daily Bonus</p></div>
                <div class="action-button" onclick="renderScreen('earningWheel')"><i class="fa-solid fa-dharmachakra"></i><p>Earning Wheel</p></div>
                <div class="action-button refer-card" onclick="renderScreen('refer')"><i class="fa-solid fa-users"></i><p>Refer & Earn</p></div>
                <div class="action-button" onclick="showToast('Coming Soon!')"><i class="fa-solid fa-gamepad"></i><p>Play & Earn</p></div>
            </div>`;
    }

    window.renderTasksContent = async function(screenEl) {
        screenEl.innerHTML = `<h2 class="screen-title">Complete Tasks</h2>` + templates.loader;
        // Placeholder, add your task fetching logic here
        setTimeout(() => {
            screenEl.innerHTML = `<h2 class="screen-title">Complete Tasks</h2><div class="glass-card"><p>No tasks available right now.</p></div>`;
        }, 1000);
    }
    
    window.renderWithdrawContent = function(screenEl) {
        screenEl.innerHTML = `<h2 class="screen-title">Withdraw Funds</h2>
            <div class="glass-card">
                <div class="form-group"><label style="display:block; margin-bottom:5px;">Amount (₹)</label><input type="number" id="withdraw-amount" placeholder="e.g., 50.00"></div>
                <div class="form-group"><label style="display:block; margin-bottom:5px;">UPI ID</label><input type="text" id="upi-id" placeholder="yourname@bank"></div>
                <button id="withdraw-request-button" class="btn-primary">Request Withdrawal</button>
            </div>`;
        screenEl.querySelector('#withdraw-request-button').addEventListener('click', handleWithdrawal);
    }
    
    window.renderProfileContent = function(screenEl) {
        const joinDate = appState.userData.memberSince ? appState.userData.memberSince.toDate().toLocaleDateString() : 'N/A';
        screenEl.innerHTML = `
            <h2 class="screen-title">My Profile</h2>
            <div class="glass-card">
                <p><strong>Username:</strong> ${appState.userData.username}</p>
                <p><strong>Email:</strong> ${appState.userData.email}</p>
                <p><strong>Joined On:</strong> ${joinDate}</p>
            </div>`;
    }

    window.renderDailyBonusContent = function(screenEl) {
        screenEl.innerHTML = `<div class="back-button" onclick="renderScreen('home')"><i class="fa-solid fa-arrow-left"></i></div><h2 class="screen-title" style="padding-top:40px;">Daily Bonus</h2><div class="glass-card" style="text-align:center;"><p>Daily Bonus feature is under development.</p></div>`;
    }
    
    window.renderEarningWheelContent = function(screenEl) {
        screenEl.innerHTML = `<div class="back-button" onclick="renderScreen('home')"><i class="fa-solid fa-arrow-left"></i></div><h2 class="screen-title" style="padding-top:40px;">Earning Wheel</h2><div class="glass-card" style="text-align:center;"><p>Earning Wheel feature is under development.</p></div>`;
    }

    window.renderReferContent = function(screenEl) {
        screenEl.innerHTML = `
            <div class="back-button" onclick="renderScreen('home')"><i class="fa-solid fa-arrow-left"></i></div>
            <h2 class="screen-title" style="padding-top:40px;">Refer & Earn</h2>
            <div class="glass-card" style="text-align:center;">
                <h3>Share Your Code!</h3><p>Share this code with your friends.</p>
                <div style="background:rgba(0,0,0,0.2); border:1px dashed var(--glass-border); padding:20px; border-radius:15px; margin: 20px 0;">
                    <p style="font-size: 24px; font-weight: 700; letter-spacing: 4px; color: var(--primary-color);">${appState.userData.referralCode || '...'}</p>
                </div>
                <button class="btn-primary" id="copy-code-btn">Copy Code</button>
            </div>`;
        screenEl.querySelector('#copy-code-btn').addEventListener('click', () => {
            navigator.clipboard.writeText(appState.userData.referralCode);
            showToast('Code Copied!');
        });
    }

    async function handleAuth(type) { /* ... Same logic as before ... */ }
    async function handleWithdrawal() { /* ... Same logic as before ... */ }

    function showToast(message, isError = false) { /* ... Same logic as before ... */ }
    
    init();
});
</script>
</body>
</html>
